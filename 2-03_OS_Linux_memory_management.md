# Домашнее задание к занятию "2.3 Память, управление памятью "

---

### Задание 1

Что происходит с оперативной памятью во время перехода ПК в:
1) сон
2) гибернацию

*Приведите ответ для каждого случая в свободной форме.*

***Ответ:***
1. "Сон" или "спящий режим позволяет" - состояние пониженного энергопотребления. В нем часть компонентов отключится и перестанет получать питание. Часть продолжит потреблять энергию для хранения инфы и быстрого выхода из "сна". Информация о текущем состояни файлов и "приложух" копируется в оперативную память, которая продолжает работать. Проблема этого режима в том, что если отключится электроэнергия, и вырубится комп - данные из "оперативки" не сохранятся и потеряются. Эта проблема в меньшей степени касается ноутов (своя АКБ) и компов, подключенных к ИБП. Система быстрее выходит из "сна" и восстанавливает работу по сравнению с "гибернацией". 

2. "Гибернация" - это энергонезавивимое состояние компьютера. Все файлы в этом режиме сохраняются на HDD или SSD в специальном файле, откуда считываются при запуске системы.

---

### Задание 2

В лекции не была упомянута одна известная команда для получения информации о нагрузке на компьютер и в частности  на ОЗУ. 

Ее вывод выглядит примерно вот так: 

<a href="https://imgbb.com/"><img src="https://i.ibb.co/7Q16Chb/2020-12-07-16-52-37.png" alt="2020-12-07-16-52-37" border="0"></a>

*Какое название этой команды?* 

***Ответ:***

Это команда **vmstat**

Варианты использования:
**'vmstat 3 3'**  - быдет выводить команду 3 раза с задержкой в 3 секунды (цифры выводятся после указания опций и могут меняться при необходимости)
**'vmstat -n 3'** - задает интервал выполнения в секундах
**'vmstat -s'** - выводит информацию в две колонки

---

## Дополнительные задания (со звездочкой*)
Эти задания дополнительные (необязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.

### Задание 3

Составьте bash-скрипт, который запишет в /home директорию вашей системы файл с именем `pcinfo.txt`, содержащий следующую информацию:

1) Архитектуру ПК (x86_64)
2) Модель процессора
3) Емкость каждого из установленных модулей памяти в ПК

*Примечание: при выполнении задания предполагается использование конструкции "{команда} | grep {параметр для обрзания вывода}"*

***Ответ:***

На моем компьютере установлена Oracle VM. В связи с этим у меня немного поменялись команды и вывод. Так как ни lscpu, ни dmidecode не отобразила нужную информацию по модулям памяти, я использовал команду lshw. В итоге получился вот такой скрипт:

sudo lscpu | grep -E '(Model name|Architecture)' > pcinfo.txt && sudo lshw - class memory >> pcinfo.txt

Здесь вывод:

<a href="https://ibb.co/WpYFNCF"><img src="https://i.ibb.co/G3bkfmk/3-1.png" alt="3-1" border="0"></a>

Если бы система была установлена на компе без VM, я использовал бы скрипт: 

sudo lscpu | grep -E '(Model name|Architecture)' > pcinfo.txt && sudo dmidecode -t memory >> pcinfo.txt

Сейчас на VM скрипт дает вот такой вывод:

<a href="https://ibb.co/HBQfKgS"><img src="https://i.ibb.co/8NVLm8C/3-2.png" alt="3-2" border="0"></a>

---

### Задание 4

Создайте swap файл размером 1Гб, подключите его к системе, добавьте его в `/etc/fstab`.

*В качестве ответа приложите скрин вывода команды `free -h -t` до и после подключения swap файла.*

***Ответ:***

В системе изначально при установке был настроен swap раздел размером 1 Gb. Это отражено в воводе до внесения изменений. Далее в систему был добавлен swapfile размером 2Gb. Внесены изменения в конфигруацию системы. Команда swapon --show выводит дополнительную информацию, что в системе есть два swap'а: раздел и файл. Суммарно swap равен 3 Gb. Скрины вывода команды `free -h -t` до и после подключения swap файла ниже.

Вывод до:

<a href="https://ibb.co/phCjTKR"><img src="https://i.ibb.co/mNQ5KyX/4-1.png" alt="4-1" border="0"></a>

Вывод после:

<a href="https://ibb.co/xsx7DPJ"><img src="https://i.ibb.co/SxF3PWR/4-2.png" alt="4-2" border="0"></a>


---

### Задание 5

Поэкспериментируйте с параметрами:

1) vm.swappiness=
2) vm.dirty_background_ratio=
3) vm.dirty_ratio = 

в конфигурационном файле `/etc/sysctl.conf`. 

*Опишите кратко как влияют эти параметры на работу Linux  с памятью. Опишите, при каких значениях система начинала работать быстрее или медленнее.*

***Ответ:***

1) vm.swappiness - уменьшение данного параметра приводит к более быстрой активации swap'a, что в свою очередь, ведет к увеличению производительности системы. Обычно этот параметр уменьшают до 0 или -1 на серверах. В моей системе, при изменении параметров, я особой разницы не почувствовал, так как в системе установлена только консоль. 
2) vm.dirty_background_ratio - при снижении этого параметра снижается количество данных ("грязных страниц"), хранимых в кэше. В связи с этим, данные записываются на диск маленькими частями, а не все сразу. Это немного увеличивает скорость работы системы. 
3) vm.dirty_ratio - при значительном снижении данного параметра приложения, которые должны писать на диск, блокируются, так как им не хватает кэша. Пока данные заблокировавшего процесса не запишутся, остальные процессы не продолжат свою работу. Это естественно приводит к торможению системы.

---

### Задание 6

Найдите информацию про tmpfs. 

*Расскажите в свободной форме, в каких случаях уместно использовать эту технологию.*

Создайте диск `tmpfs` (сколько вам позволяет ОЗУ на ПК 512Мб-1Гб), смонтируйте его в директорию `/mytmpfs`.

*В качестве ответа приведите скрин вывода команды df- h до и после монтирования диска tmpfs.*

***Ответ:***

Tmpfs - это виртуальная файловая система, которая располагается в ОЗУ. Используется для того, чтобы получить очень быстрый доступ к файлам. Это могут быть, к примеру, файлы БД или веб-сервера. Кроме того, позволяет снизить износ постоянного хранилища, если система установлена на карту памяти. И еще, система может быть незаметной. Все процессы будут происходить в ОЗУ, в постоянных хранилищах не останется никаких следов.

Вывод команды df- h до:

<a href="https://ibb.co/rdFdcH6"><img src="https://i.ibb.co/5KGKnL8/6-1.png" alt="6-1" border="0"></a>

Вывод команды df- h после:

<a href="https://ibb.co/nDJGHZz"><img src="https://i.ibb.co/9q5DFzs/6-2.png" alt="6-2" border="0"></a>

---